var createjs,_,Graphics,Game,g;(function(n){var u=function(){function n(){document.body.onkeydown=function(t){t=t||window.event;var r=t.charCode||t.keyCode,i=n.keyBindings[""+r];i!=undefined&&i()}}return n.prototype.bind=function(t,i){n.keyBindings[t]=i},n.keyBindings={},n}(),t,i,r;n.TetrisRoot=u,t=function(){function n(){createjs.Ticker.setInterval(200),createjs.Ticker.setFPS(2),createjs.Ticker.useRAF=!0}return n.pause=function(){var n=!createjs.Ticker.getPaused();createjs.Ticker.setPaused(n)},n.prototype.setCallback=function(n){createjs.Ticker.addListener(n)},n}(),n.TetrisTimer=t,i=function(){function n(){this.stage=new createjs.Stage("tetris")}return n.prototype.place=function(){},n.prototype.addChild=function(n){this.stage.addChild(n)},n.prototype.removeChild=function(n){this.stage.removeChild(n)},n.prototype.update=function(){this.stage.update()},n.prototype.unplace=function(){},n.prototype.remove=function(){},n}(),n.TetrisCanvas=i,r=function(){function n(n,t,i,r,u,f){this.rect=new createjs.Shape,this.rect.graphics.beginFill(f).drawRect(t,i,r,u),this.canvas=n,this.canvas.addChild(this.rect),this.canvas.update()}return n.prototype.move=function(n,t){this.rect.x+=n,this.rect.y+=t},n.prototype.remove=function(){this.canvas.removeChild(this.rect)},n}(),n.TetrisRect=r})(Graphics||(Graphics={})),function(n){var t=function(){function n(t,i){this.base_position=[5,0],this.moved=!0,this.all_rotations=t,this.rotation_index=0;var r=Math.floor(Math.random()*n.AllColors.length);this.color=n.AllColors[r],this.base_position=[5,0],this.board=i,this.moved=!0}return n.prototype.current_rotation=function(){return this.all_rotations[this.rotation_index]},n.prototype.dropByOne=function(){return this.moved=this.move(0,1,0),this.moved},n.prototype.move=function(n,t,i){var u,r,f;for(this.moved=!0,u=this.all_rotations[(this.rotation_index+i)%this.all_rotations.length],r=0;r<u.length;++r)f=u[r],this.board.emptyAt([f[0]+n+this.base_position[0],f[1]+t+this.base_position[1]])||(this.moved=!1);return this.moved&&(this.base_position[0]+=n,this.base_position[1]+=t,this.rotation_index=(this.rotation_index+i)%this.all_rotations.length),this.moved},n.rotations=function(n){var t=_.map(n,function(n,t){return[-t,n]}),i=_.map(n,function(n,t){return[-n,t]}),r=_.map(n,function(n,t){return[t,-n]});return[n,t,i,r]},n.next_piece=function(t){var i=Math.floor(Math.random()*this.All_Pieces.length);return new n(this.All_Pieces[i],t)},n.All_Pieces=[[[[0,0],[1,0],[0,1],[1,1]]],n.rotations([[0,0],[-1,0],[1,0],[0,-1]]),[[[0,0],[-1,0],[1,0],[2,0]],[[0,0],[0,-1],[0,1],[0,2]]],n.rotations([[0,0],[0,-1],[0,1],[1,1]]),n.rotations([[0,0],[0,-1],[0,1],[-1,1]]),n.rotations([[0,0],[-1,0],[0,-1],[1,-1]]),n.rotations([[0,0],[1,0],[0,-1],[-1,-1]])],n.AllColors=["DarkGreen","dark blue","dark red","gold2","Purple3","OrangeRed2","LightSkyBlue"],n}(),i,r;n.Piece=t,i=function(){function n(n){this.score=0,this.delay=500,this.blockSize=15,this.numColumns=10,this.numRows=27,this.grid=new Array(this.numRows);for(var i=0;i<this.numRows;i++)this.grid[i]=new Array(this.numColumns);this.currentBlock=t.next_piece(this),this.game=n}return n.prototype.game_over=function(){return!1},n.prototype.run=function(){var n=this.currentBlock.dropByOne();console.log(n),n||(this.storeCurrent(),console.log("stored piece."),this.game_over()||(console.log("getting next piece"),this.next_piece())),this.draw()},n.prototype.move_left=function(){!this.game_over()&&this.game.isRunning&&this.currentBlock.move(-1,0,0),this.draw()},n.prototype.move_right=function(){!this.game_over()&&this.game.isRunning&&this.currentBlock.move(1,0,0),this.draw()},n.prototype.rotate_clockwise=function(){!this.game_over()&&this.game.isRunning&&this.currentBlock.move(0,0,1),this.draw()},n.prototype.rotate_counter_clockwise=function(){!this.game_over()&&this.game.isRunning&&this.currentBlock.move(0,0,-1),this.draw()},n.prototype.drop_all_the_way=function(){if(this.game.isRunning){for(var n=this.currentBlock.dropByOne();n;)_.each(this.current_pos,function(n){n.remove}),this.score+=1,n=this.currentBlock.dropByOne();this.draw(),this.storeCurrent(),this.game_over()||this.next_piece(),this.draw()}},n.prototype.next_piece=function(){this.currentBlock=t.next_piece(this),this.current_pos=null},n.prototype.storeCurrent=function(){for(var r=this.currentBlock.current_rotation(),i=this.currentBlock.base_position,t,n=0;n<4;n++)t=r[n],this.grid[t[1]+i[1]][t[0]+i[0]]=this.current_pos[n]},n.prototype.emptyAt=function(n){if(n[0]>=0&&n[0]<this.numColumns){if(n[1]<1)return!0;if(n[1]>=this.numRows)return!1}else return!1;return this.grid[n[1]][n[0]]==null},n.prototype.removeFilled=function(){for(var r,t,i,n=2;n<this.grid.length;n++)if(r=this.grid.slice(n),_.every(this.grid[n])){for(t=0;t<this.numColumns;t++)this.grid[n][t].remove(),this.grid[n][t]=null;for(i=this.grid.size-n+1;i<=this.grid.length;i++);this.grid[0]=new Array(this.numColumns),this.score+=10}},n.prototype.draw=function(){this.current_pos=this.game.draw_piece(this.currentBlock,this.current_pos)},n}(),n.Board=i,r=function(){function n(){this.root=new Graphics.TetrisRoot,this.ticker=new Graphics.TetrisTimer,this.canvas=new Graphics.TetrisCanvas,this.ticker.setCallback(this),this.board=new i(this),this.isRunning=!0,this.keyBindings()}return n.prototype.keyBindings=function(){var n=this;this.root.bind(37,function(){n.board.move_left()}),this.root.bind(39,function(){n.board.move_right()}),this.root.bind(38,function(){n.board.rotate_clockwise()}),this.root.bind(40,function(){n.board.rotate_counter_clockwise()}),this.root.bind(32,function(){n.board.drop_all_the_way()})},n.prototype.tick=function(){this.isRunning&&this.board.run()},n.prototype.draw_piece=function(n,t){var f,i,u;if(t!=null&&n.moved)for(i=0;i<t.length;i++)f=t[i],f.remove();var r=this.board.blockSize,e=n.current_rotation(),o=n.base_position,s=[];for(i=0;i<e.length;i++)u=e[i],s.push(new Graphics.TetrisRect(this.canvas,o[0]*r+u[0]*r+3,o[1]*r+u[1]*r,15,15,n.color));return s},n}(),n.Tetris=r}(Game||(Game={})),g=new Game.Tetris